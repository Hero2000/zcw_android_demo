
没错，很多同学第一马上就想到了sp.
sp是android提供给我们的一种轻量级 k-v 数据持久化方式。
我们用着很爽，但是同学们，你们在使用shared的时候，有没有出现过数据丢失？
有没有出现过，由于频繁读写导致的卡顿甚至anr崩溃？

那么针对这样的情况，我们有什么办法可以去改善它？
很多同学没想到我们用着这么爽的shared还能够怎么去优化，
那么今天就跟着lance老师来看看，怎么从不同的角度来实现一个高性能的k-v持久化框架。
也就是今天的主角-mmkv的实现原理。
====================================
io是一个耗时操作，一般的在进行io操作的时候我们会放入到子线程当中执行。
线程的调度是抢占式的，如果线程数大于cpu核心数，系统会为线程分配一个时间片段，在这个时间内执行线程任务，
如果到达规定时间，则会发生线程上下文切换，让cpu执行下一个任务，
这时候需要进行上下文切换保存上一个任务的状态，用于下次执行时可以再次加载这个状态。

这就好像你去做大保健，到钟了，你还没有得到满足，那么你就会非常的难受，
你想要加钟，但是这个技师已经被下一个客人预订了。
而大保健老板也需要消耗精力在多个客人之间协调。
所以执行下一个线程需要发生上下文切换会导致cpu在寄存器和运行队列之间来回奔波带来性能损耗。


====================================

数据结构：
能够利用最小的数据表示更多的信息，就意味着我们的优化越成功！


那么
shared是以xml来进行数据写入的，
我们都知道xml来记录信息，需要的数据量非常大，因为其中包含了很多的冗余无用的tag等信息
而mmkv呢，则使用一种更精简的数据结构，
这种方式排除了无效的信息，能够以更小的数据量表示更多的数据。
这样我们在进行数据操作的时候，比如 写入一个 1G大小的数据和写入一个 1M大小的数据。
肯定是1m的更快。


为什么不直接写进去要使用最高位作为标记？
1111 1111  -> 1个字节
1111 1111  -> 1个字节
当读到这里时候，长度到底是 1111 1111 1111 1111
还是 1111 1111? 换句话说，长度是1个字节还是两个字节？
不知道！ 所以使用一个标记在解析的时候确定这个数据是否读完了，如果最高位是1，表示还要加上下一个8位
====================================



主要经过这三个方式的优化之后，mmkv比shared 效率高可以说就是必然的了。
性能优化的核心目的就是 提升程序的稳定性、资源利用率与执行效率
这三点，对于移动端来说尤为重要。
就像今天的mmkv，对于很多同学来说 key-value 组件直接就使用shared就可以了。
但是像tencent这种大企业对待如此苛刻的性能要求，可以说是丧心病狂，
就为了保存一下key-value数据，竟然会不辞幸苦的编写一个这样的组件。
而这个组件内的很多知识，对于大部分的android程序员
要不就没听过，
要不就觉得没用。

你凭什么觉得没用？android本身就是基于linux系统的，
对于c/c++的开发，linux编程，你一点都不清楚还有理了？
就像ndk，很多同学觉得在平时的开发中用的少，不用学。
那么这样的同学，我觉得 已经能够预见未来1、2年你是一个什么状态
不主动争取，不主动进行知识储备，扫除知识盲点，
难道还真的像驴子一样，被生活抽一下 走一下吗。
作为企业，为什么要给这样的人高薪？

现在还有没有人因为自己又用一些开源库，堆砌出来了一些业务功能而沾沾自喜的？
就这样还指望马上到来的金三银四 找到一份多好的工作，有没有可能？

难道你就甘心，在自己应该奋斗的年龄，出卖着廉价的劳动力
仅仅只是混口饭吃？

大家可以站在面试官的角度想一想，你是希望招收的是真正能够给自己帮助，
降低自己工作压力
能够与自己互相学习的人，还是一个写代码完全不考虑架构、性能
还天天需要你帮忙擦屁股的人？
结果显而易见。

我知道都想拿高薪，但是企业凭什么给你高薪？
有多大能力承担多大的责任 享受多大的报酬

大家可以看到，boss直聘上

这些android岗位的薪资都不低，
这说明企业它缺的不是薪资的这些钱，缺的是拥有真材实料能够把活干好的人。


很多同学现在处理这样的状况：
ppt



没有人希望一直处于金字塔的绝大多数人，
都希望自己能够尽可能的往上挪一挪。
所以我们一直在学习。

我们可以买书，可以在晚上找资料
在当当上 .....

这么多的书籍中，选择就挑花眼了，
有多少同学，买了书
在看的过程中，遇到问题，渴望得到指点，但是没有人提供帮助
又或者是无法坚持，根本就没看完？
看完之后呢？ 还记不记得这些内容，能不用用于实战当中去？
这些都是困扰我们自学的问题

针对现在日渐成熟的市场，要求只会越来越高，
强者恒强
在别人在路上享受沿途的风景的时候，
我们应该怎么奋起直追？


为了帮助，同学们 实现这种超越
我们应该
规划学习路线，建立完善的知识体系
节省时间，高效学习，快速提升。
所以享学课堂提供给大家服务有：
xxxx


在进行这些服务的同时，我们需要一步步提高自己，
有哪些知识需要我们掌握？
注意了，同学们，自己应该怎么发展 这非常重要。
哪怕你自己私底下去进行学习，也需要规划好自己的时间与学习目标。





















